# Синтетическое тестирование виджета Playgama

## Функциональность теста

### Отслеживаемые события

Тест отслеживает следующие аналитические события Google Analytics:

- **`success_load_content`** - Успешная загрузка контента банера
- **`error_load_content`** - Неуспешная загрузка контента банера  
- **`widget_impression`** - Виджет показался больше чем на 50% хотя бы один раз
- **`click_widget`** - Клик по баннеру
- **`close_modal`** - Закрытие модального окна
- **`game_impression`** - Просмотр превью игры
- **`click_game`** - Клик по игре

### Сетевые запросы

Тест отслеживает все POST-запросы к:
- Аналитическим серверам (`analytics`)
- Google Analytics (`google-analytics`, `gtag`, `collect`)
- Серверам Playgama (`playgama`)

### Логика тестирования

1. **Загрузка страницы** - открытие страницы с виджетом
2. **Поиск виджета** - ожидание появления элемента `#widget-playgama`
3. **Анализ контента** - проверка содержимого виджета
4. **Клики по виджету** - клики по центру и углам виджета
5. **Отслеживание событий** - мониторинг аналитических событий
6. **Поиск iframe** - обнаружение новых iframe после кликов

## Результаты тестирования

### Статистика тестирования

- **Всего тестов**: Настраивается в коде
- **Успешных кликов**: Клики, которые привели к появлению iframe
- **Неудачных кликов**: Клики без реакции
- **Ошибок загрузки**: Проблемы с загрузкой страницы
- **Виджет не найден**: Проблемы с поиском виджета

### Аналитические события

Тест подсчитывает количество каждого типа аналитического события:
- `success_load_content`: 0
- `error_load_content`: 0  
- `widget_impression`: 0
- `click_widget`: 0
- `close_modal`: 0
- `game_impression`: 0
- `click_game`: 0

## Запуск тестов

### Установка зависимостей
```bash
npm install
```

### Запуск теста
```bash
npm test
```

### Настройка параметров

В файле `test_widget.ts` можно настроить:
- `testUrl` - URL страницы с виджетом
- `numTests` - количество тестов (по умолчанию 100)
- `headless` - режим браузера (true/false)
- `slowMo` - задержка между действиями

## Технические детали

### Технологии
- **TypeScript** - основной язык
- **Playwright** - автоматизация браузера
- **Node.js** - среда выполнения

### Структура кода

```typescript
class WidgetTester {
  // Основной класс для тестирования
  async runSingleTest() // Один тест
  async runTests()      // Серия тестов
  _printResults()       // Вывод результатов
  saveResults()         // Сохранение в JSON
}
```

## Выводы

Синтетический тест с отслеживанием аналитических событий позволяет:
- Проверить корректность отправки событий в Google Analytics
- Сравнить результаты с реальной статистикой
- Выявить проблемы с отображением и интерактивностью виджета
- Оптимизировать настройки для улучшения CTR 